<app-navbar></app-navbar>

<main class="profile-page" dir="rtl">
  <div class="container">

    <section *ngIf="user && !loading" class="profile-card">

      <!-- Avatar فقط (بدون غلاف) -->
      <div class="avatar-wrapper">
        <img
          class="avatar"
          [src]="user.profilePictureUrl || 'assets/images/my_img.jpg'"
          alt="avatar"
          loading="lazy"
        />

        <button class="btn-change-avatar" (click)="triggerFileInput()">
          <span>تغيير الصورة</span>
        </button>
      </div>

      <h1 class="display-name">{{ user.firstName }} {{ user.lastName }}</h1>
      <p class="sub">{{ user.email }}</p>
      <p class="sub muted">{{ user.phoneNumber || "—" }}</p>

      <div class="badges-row">
        <span class="info-pill">المفقودات: {{ user.lostItemsCount ?? 0 }}</span>
        <span class="info-pill">الموجودات: {{ user.foundItemsCount ?? 0 }}</span>
      </div>

      <div class="details-card">
        <div class="details-row">
          <div><strong>معرّف المستخدم:</strong></div>
          <div class="mono">
            {{ shortId(user.id) }}
            <button class="copy-btn" (click)="copyId(user.id)">نسخ</button>
          </div>
        </div>

        <div class="details-row" *ngIf="user.createdAt">
          <div><strong>تاريخ الإنشاء:</strong></div>
          <div>{{ user.createdAt | date: "medium" }}</div>
        </div>
      </div>

      <div class="actions">
        <button class="btn-primary" (click)="goEdit()">تعديل الملف الشخصي</button>
        <button class="btn-ghost" (click)="logout()">تسجيل الخروج</button>
      </div>

      <input type="file" #fileInput accept="image/*" style="display:none" (change)="onFileSelected($event)" />

      <div id="toast-container" aria-live="polite" class="toast-container"></div>
    </section>

    <div *ngIf="loading" class="loading">جاري التحميل...</div>
    <div *ngIf="error && !loading" class="error-box">{{ error }}</div>
  </div>
</main>
